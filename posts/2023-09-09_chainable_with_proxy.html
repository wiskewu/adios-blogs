<html lang="zh"><head><title>Adiós Blog - 简单写一个石头剪刀布游戏</title><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Adiós的个人博客网站"/><meta name="author"/><meta name="kewords" content="Adiós's independent blog"/><link rel="stylesheet" href="/adios-blogs/statics/css/purecss/purecss-min@2.1.0.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/purecss/purecss@2.1.0-base-min.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/purecss/purecss@2.1.0-grids-responsive-min.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/theme.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/layout.css"/><link rel="apple-touch-icon" sizes="180x180" href="/adios-blogs/statics/icons/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/adios-blogs/statics/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/adios-blogs/statics/icons/favicon-16x16.png"/><link rel="manifest" href="/adios-blogs/statics/icons/site.webmanifest"/><link id="hl-github" rel="stylesheet" href="/adios-blogs/statics/css/highlight.js/github.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/markdown.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/katex/katex.min@0.5.1.css"/><link rel="stylesheet" href="/adios-blogs/statics/css/post.css"/></head><body class="theme-light"><div id="app"><div id="app-container"><header class="app-post-header pure-g"><div class="pure-u-1"><div class="pure-g app-post-header--box"><h1 class="pure-u-1 post-header-title">简单写一个石头剪刀布游戏</h1><div class="pure-u-1 post-header-info"><p class="post-header-info--created"><svg class="icon icon" aria-hidden="true"><use xlink:href="#calendar" x="0" y="0" width="16" height="16"></use></svg><span>09/09/2023 17:22</span></p><span class="post-header-info--divider">·</span><p class="post-header-info--author"><svg class="icon icon" aria-hidden="true"><use xlink:href="#pencil-alt" x="0" y="0" width="16" height="16"></use></svg><span>wiskewu</span></p></div></div></div></header><div class="pure-g app-post-navigation"><span click="toggleTheme()"><a href="/adios-blogs/"><svg class="icon icon" aria-hidden="true" style="width:24px;height:24px;"><use xlink:href="#home" x="0" y="0" width="24" height="24"></use></svg></a></span><span class="theme-btn" onclick="toggleTheme(this)"><svg class="icon icon" aria-hidden="true" style="width:24px;height:24px;"><use xlink:href="#sun" x="0" y="0" width="24" height="24"></use></svg></span></div><hr/><main class="app-body"><section class="app-post-body"><article class="markdown app-post-body-content"><h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景">¶</a>背景</h2>
<p>最近在逛github时看到一个开源库，还蛮有意思的。花点时间阅读了源码，遂写了一个小游戏来加强理解～</p>
<blockquote>
<p>可以<a href="https://github.com/yairEO/console-colors">&gt;&gt;&gt;猛戳这里</a>查看<code>console-colors</code>源码</p>
</blockquote>
<h2 id="石头剪刀布" tabindex="-1"><a class="header-anchor" href="#石头剪刀布">¶</a>石头剪刀布</h2>
<pre class="language-javascript" data-lang="Javascript"><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRSP</span>(<span class="hljs-params"></span>) {
    <span class="hljs-comment">// 被代理对象</span>
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RSP</span> = {};
    <span class="hljs-keyword">const</span> queue = [];
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RPS_MAP</span> = {
        <span class="hljs-string">&quot;R&quot;</span>: <span class="hljs-string">&quot;Rock&quot;</span>,
        <span class="hljs-string">&quot;P&quot;</span>: <span class="hljs-string">&quot;Paper&quot;</span>,
        <span class="hljs-string">&quot;S&quot;</span>: <span class="hljs-string">&quot;Scissors&quot;</span>
    };

    <span class="hljs-keyword">const</span> proxyRSP = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(<span class="hljs-variable constant_">RSP</span>, {
        <span class="hljs-title function_">get</span>(<span class="hljs-params">t, p</span>) {
            <span class="hljs-comment">// 优先级：代理 &gt; 被代理对象</span>
            <span class="hljs-keyword">return</span> p <span class="hljs-keyword">in</span> t ? t[p] : <span class="hljs-variable constant_">RSP</span>;
        }
    });

    <span class="hljs-comment">// 定义代理属性</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">def</span> = (<span class="hljs-params">name, value</span>) =&gt; {
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(proxyRSP, name, {
            <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) {
                queue.<span class="hljs-title function_">push</span>(value);
                <span class="hljs-keyword">return</span> proxyRSP;
            }
        });
    };

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> k <span class="hljs-keyword">in</span> <span class="hljs-variable constant_">RPS_MAP</span>) {
        <span class="hljs-title function_">def</span>(k, <span class="hljs-variable constant_">RPS_MAP</span>[k]);
    }

    <span class="hljs-comment">// 收敛函数</span>
    proxyRSP.<span class="hljs-property">done</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
        <span class="hljs-keyword">const</span> q = [...queue];
        queue.<span class="hljs-property">length</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">const</span> result = {
            q,
            <span class="hljs-title function_">vs</span>(<span class="hljs-params">to</span>) {
                <span class="hljs-comment">// 模拟返回一个新方法，给外部调用，以支持调试定位上下文（source-map）</span>
                <span class="hljs-keyword">const</span> score = <span class="hljs-title function_">_vs</span>(result, to);
                <span class="hljs-keyword">if</span> (score === <span class="hljs-number">0</span>) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;NO ONE WINS!&quot;</span>);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (score &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;YOU WIN!&quot;</span>);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;YOU LOSE!&quot;</span>);
                }
            }
        };
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">// 游戏逻辑，可忽略</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">_vs</span>(<span class="hljs-params">resultA, resultB</span>) {
        <span class="hljs-keyword">var</span> q1 = resultA.<span class="hljs-property">q</span>, q2 = resultB.<span class="hljs-property">q</span>;
        <span class="hljs-keyword">var</span> l1 = q1.<span class="hljs-property">length</span>,
            l2 = q2.<span class="hljs-property">length</span>,
            len = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(l1, l2);
        <span class="hljs-keyword">var</span> y = n = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; len; i++) {
            <span class="hljs-keyword">var</span> a = q1[i], b = q2[i];
            <span class="hljs-keyword">if</span> (a === b) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (
                (a === <span class="hljs-variable constant_">RPS_MAP</span>.<span class="hljs-property">R</span> &amp;&amp; b === <span class="hljs-variable constant_">RPS_MAP</span>.<span class="hljs-property">S</span>) ||
                (a === <span class="hljs-variable constant_">RPS_MAP</span>.<span class="hljs-property">P</span> &amp;&amp; b === <span class="hljs-variable constant_">RPS_MAP</span>.<span class="hljs-property">R</span>) ||
                (a === <span class="hljs-variable constant_">RPS_MAP</span>.<span class="hljs-property">S</span> &amp;&amp; b === <span class="hljs-variable constant_">RPS_MAP</span>.<span class="hljs-property">P</span>)
            ) ++y;
            <span class="hljs-keyword">else</span> ++n;
        }
        <span class="hljs-keyword">return</span> y === n ? <span class="hljs-number">0</span> : y &gt; n ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
    }

    <span class="hljs-keyword">return</span> proxyRSP;
}

<span class="hljs-comment">// test cases</span>
<span class="hljs-keyword">const</span> rsp = <span class="hljs-title function_">genRSP</span>();

rsp.<span class="hljs-property">R</span>.<span class="hljs-property">P</span>.<span class="hljs-property">S</span>.<span class="hljs-property">R</span>.<span class="hljs-property">R</span>.<span class="hljs-title function_">done</span>().<span class="hljs-title function_">vs</span>(rsp.<span class="hljs-property">S</span>.<span class="hljs-property">P</span>.<span class="hljs-property">R</span>.<span class="hljs-property">R</span>.<span class="hljs-title function_">done</span>()); <span class="hljs-comment">// NO ONE WINS!</span>
rsp.<span class="hljs-property">R</span>.<span class="hljs-title function_">done</span>().<span class="hljs-title function_">vs</span>(rsp.<span class="hljs-property">S</span>.<span class="hljs-property">S</span>.<span class="hljs-title function_">done</span>()); <span class="hljs-comment">// YOU WIN!</span>
rsp.<span class="hljs-property">S</span>.<span class="hljs-title function_">done</span>().<span class="hljs-title function_">vs</span>(rsp.<span class="hljs-property">R</span>.<span class="hljs-title function_">done</span>()); <span class="hljs-comment">// YOU LOSE!</span>

</code></pre>
<hr>
<h2 id="补充" tabindex="-1"><a class="header-anchor" href="#补充">¶</a>补充</h2>
<p>基本的核心逻辑已在源码中作出解释，另补充几个关键点：</p>
<ul>
<li>通过<code>proxy</code>的<code>getter trap</code>实现在读取属性时进行额外的计算/缓存等逻辑</li>
<li>通过返回<code>proxy</code>本身来实现链式调用</li>
<li>通过返回新的函数，将最终函数调用控制权交给使用方，对源码调试更友好</li>
<li>在最后一个进行收尾操作，实现过程的收敛</li>
</ul>
</article></section></main><section class="app-post-footer"><div class="pure-g app-post-footer--box"><div class="pure-u-1"><div class="pure-g"><svg class="icon icon" aria-hidden="true"><use xlink:href="#tag" x="0" y="0" width="16" height="16"></use></svg><ul class="pure-g post-footer-tags"><li><a href="/adios-blogs/tags/proxy/1.html" title="proxy">proxy</a></li><li><a href="/adios-blogs/tags/game/1.html" title="game">game</a></li></ul></div></div><div class="pure-u-1"><div class="pure-g"><svg class="icon icon" aria-hidden="true"><use xlink:href="#folder" x="0" y="0" width="16" height="16"></use></svg><ul class="pure-g post-footer-categories"><li><a href="/adios-blogs/categories/js/1.html" title="JS">JS</a></li></ul></div></div></div></section><style>body {
    scroll-behavior: smooth;
}
ol.toc-list {
    counter-reset: list-item;
}
li.toc-list-item {
    display: block;
    counter-increment: list-item;
}
li.toc-list-item::before {
    content: counters(list-item,'.') ' ';
}
a.toc-list-item-link {
    text-decoration: none;
}

#toc {
    position: fixed;
    right: -22rem;
    top: 0;
    width: 22rem;
    height: 100vh;
    transition: right .3s;
    z-index: 1;
    background-color: var(--toc-bg-color);
}
#toc.toc-show {
    right: 0em;
}
#toc-container {
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    padding: 2em;
    max-height: 100%;
    overflow-y: auto;
}
#toc-container > h3 { margin: 0; margin-bottom: 2em; }
#toc-container > nav.table-of-contents ol {
    margin: 0; padding: 0;
}
#toc-container > nav.table-of-contents li.toc-list-item ol {
    padding-left: 2em;
}
nav.table-of-contents li.toc-list-item a.toc-list-item-link::after {
    display: block;
    content: '';
    margin-bottom: 0.3em;
}
span#toc-btn {
    position: absolute;
    display: block;
    left: -28px;
    top: 50%;
    bottom: 0;
    transform: translateY(-50%);
    width: 28px;
    height: 28px;
    cursor: pointer;
    z-index: 1;
    opacity: .5;
}
#toc.toc-show span#toc-btn {
    left: 0px;
    transition: left .3s;
}

@media screen and (max-width: 412px) {
    #toc {
        display: none;
    }
}
</style><div class="toc-show" id="toc"><div id="toc-container"><h3>目录</h3><nav class="table-of-contents"><ol class="toc-list"><li class="toc-list-item"><a class="toc-list-item-link" href="#%E8%83%8C%E6%99%AF">背景</a></li><li class="toc-list-item"><a class="toc-list-item-link" href="#%E7%9F%B3%E5%A4%B4%E5%89%AA%E5%88%80%E5%B8%83">石头剪刀布</a></li><li class="toc-list-item"><a class="toc-list-item-link" href="#%E8%A1%A5%E5%85%85">补充</a></li></ol></nav></div><span id="toc-btn"><svg class="icon icon" aria-hidden="true" style="width:28px;height:28px;"><use xlink:href="#map" x="0" y="0" width="28" height="28"></use></svg></span></div><script>~(function() {
    var btn = document.getElementById('toc-btn');
    var toc = document.getElementById('toc');
    if (btn && toc) {
        btn.addEventListener('click', function () {
            toc.classList.toggle('toc-show');
        });
    }
})();</script><style>.scroll-btn {
    position: fixed;
    display: none;
    right: 3em;
    bottom: 4.5em;
    width: 28px;
    height: 28px;
    opacity: .5;
    cursor: pointer;
    z-index: 1;
}
.scroll-btn:hover {
    opacity: 1;
}
</style><span class="scroll-btn"><svg class="icon icon" aria-hidden="true" style="width:28px;height:28px;"><use xlink:href="#arrow-up" x="0" y="0" width="28" height="28"></use></svg></span><script>function getBtn() {
    var btns = document.getElementsByClassName('scroll-btn');
    if (btns && btns.length) return btns[0];
    return null;
}
function scrollTop(btn) {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
    btn.style.display = 'none';
}

function debouce(callback, ms) {
    var t = null;
    return function () {
        var args = Array.prototype.slice.call(arguments);
        var ctx = this;
        if (t) {
            clearTimeout(t);
        }
        t = setTimeout(function () {
                clearTimeout(t);
                t = null;
                callback.apply(ctx, args);
            }, ms);
    }
}

//- place here for dom ready
~(function () {
    function setStyle() {
        var btn = getBtn();
        var sH = window.scrollY;
        if (btn) {
            btn.style.display = sH > 100 ? 'inline' : 'none';
        }
        return btn;
    }

    var btn = setStyle();
    if (btn) {
        btn.addEventListener('click', function () {
            scrollTop(this);
        });
        window.onscroll = debouce(setStyle, 500);
    }
    btns = null;
})();</script><footer class="pure-g app-footer"><div class="pure-u-1"><div class="pure-g"><div class="pure-u-1"><abbr class="share-license" title="This site and all its content are licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.">CC BY-NC 4.0</abbr><span class="copyright">&copy; wiskewu. 20222023</span></div><div class="pure-u-1 last-update">站点始于: 2022/07/17 最后更新于: 9/9/2023</div></div></div></footer></div></div></body><script src="/adios-blogs/statics/js/main.js"></script></html>